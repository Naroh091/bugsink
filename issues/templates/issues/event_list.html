{% extends "issues/base.html" %}
{% load issues %}
{% load add_to_qs %}
{% load humanize %}
{% load i18n %}

{% block main_panel %}
    <div class="ml-4 mb-4 mr-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-x-auto flex-[2_1_96rem]">

        <div class="flex items-center px-3 py-2 bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-700">
            <div class="text-sm text-slate-500 dark:text-slate-400 italic">
                {% translate "Showing" %} {{ page_obj.start_index|intcomma }} - {{ page_obj.end_index|intcomma }} {% translate "of" %}
                {% if page_obj.paginator.count == issue.stored_event_count and issue.stored_event_count == issue.digested_event_count %}
                    {{ page_obj.paginator.count|intcomma }} {% translate "total events." %}
                {% elif page_obj.paginator.count == issue.stored_event_count and issue.stored_event_count != issue.digested_event_count %}
                    {{ page_obj.paginator.count|intcomma }} {% translate "available events" %} ({{ issue.digested_event_count|intcomma }} {% translate "total observed" %}).
                {% elif page_obj.paginator.count != issue.stored_event_count and issue.stored_event_count == issue.digested_event_count %}
                    {{ page_obj.paginator.count|intcomma }} {% translate "events found" %} ({{ issue.digested_event_count|intcomma }} {% translate "total observed" %}).
                {% else %}
                    {{ page_obj.paginator.count|intcomma }} {% translate "events found" %} ({{ issue.stored_event_count|intcomma }} {% translate "available" %}, {{ issue.digested_event_count|intcomma }} {% translate "total observed" %}).
                {% endif %}
            </div>

            <div class="ml-auto flex items-center">
                <form action="." method="get">
                <input type="text" name="q" value="{{ q }}" placeholder="{% translate 'search...' %}" class="bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 focus:border-cyan-500 dark:focus:border-cyan-400 focus:ring-cyan-200 dark:focus:ring-cyan-700 rounded-md text-sm px-2 py-1 mr-1"/>
                </form>

                {% if page_obj.has_previous %}
                <a href="?{% add_to_qs page=1 %}" class="text-slate-500 dark:text-slate-300 border-slate-300 dark:border-slate-600 px-1.5 py-1 mr-0.5 border rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 active:ring-3 inline-flex items-center justify-center" title="First page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M3.22 7.595a.75.75 0 0 0 0 1.06l3.25 3.25a.75.75 0 0 0 1.06-1.06l-2.72-2.72 2.72-2.72a.75.75 0 0 0-1.06-1.06l-3.25 3.25Zm8.25-3.25-3.25 3.25a.75.75 0 0 0 0 1.06l3.25 3.25a.75.75 0 1 0 1.06-1.06l-2.72-2.72 2.72-2.72a.75.75 0 0 0-1.06-1.06Z" clip-rule="evenodd" /></svg></a>
                {% else %}
                <div class="text-slate-300 dark:text-slate-600 border-slate-200 dark:border-slate-700 px-1.5 py-1 mr-0.5 border rounded-md inline-flex items-center justify-center" title="First page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M3.22 7.595a.75.75 0 0 0 0 1.06l3.25 3.25a.75.75 0 0 0 1.06-1.06l-2.72-2.72 2.72-2.72a.75.75 0 0 0-1.06-1.06l-3.25 3.25Zm8.25-3.25-3.25 3.25a.75.75 0 0 0 0 1.06l3.25 3.25a.75.75 0 1 0 1.06-1.06l-2.72-2.72 2.72-2.72a.75.75 0 0 0-1.06-1.06Z" clip-rule="evenodd" /></svg>
                </div>
                {% endif %}

                {% if page_obj.has_previous %}
                <a href="?{% add_to_qs page=page_obj.previous_page_number %}" class="text-slate-500 dark:text-slate-300 border-slate-300 dark:border-slate-600 px-1.5 py-1 mr-0.5 border rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 active:ring-3 inline-flex items-center justify-center" title="Previous page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M9.78 4.22a.75.75 0 0 1 0 1.06L7.06 8l2.72 2.72a.75.75 0 1 1-1.06 1.06L5.47 8.53a.75.75 0 0 1 0-1.06l3.25-3.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" /></svg>
                </a>
                {% else %}
                <div class="text-slate-300 dark:text-slate-600 border-slate-200 dark:border-slate-700 px-1.5 py-1 mr-0.5 border rounded-md inline-flex items-center justify-center" title="Previous page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M9.78 4.22a.75.75 0 0 1 0 1.06L7.06 8l2.72 2.72a.75.75 0 1 1-1.06 1.06L5.47 8.53a.75.75 0 0 1 0-1.06l3.25-3.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" /></svg>
                </div>
                {% endif %}

                {% if page_obj.has_next %}
                <a href="?{% add_to_qs page=page_obj.next_page_number %}" class="text-slate-500 dark:text-slate-300 border-slate-300 dark:border-slate-600 px-1.5 py-1 mr-0.5 border rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 active:ring-3 inline-flex items-center justify-center" title="Next page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M6.22 4.22a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06L8.94 8 6.22 5.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
                </a>
                {% else %}
                <div class="text-slate-300 dark:text-slate-600 border-slate-200 dark:border-slate-700 px-1.5 py-1 mr-0.5 border rounded-md inline-flex items-center justify-center" title="Next page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M6.22 4.22a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06L8.94 8 6.22 5.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
                </div>
                {% endif %}

                {% if page_obj.has_next %}
                <a href="?{% add_to_qs page=page_obj.paginator.num_pages %}" class="text-slate-500 dark:text-slate-300 border-slate-300 dark:border-slate-600 px-1.5 py-1 mr-0.5 border rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 active:ring-3 inline-flex items-center justify-center" title="Last page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M12.78 7.595a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06l2.72-2.72-2.72-2.72a.75.75 0 0 1 1.06-1.06l3.25 3.25Zm-8.25-3.25 3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06l2.72-2.72-2.72-2.72a.75.75 0 0 1 1.06-1.06Z" clip-rule="evenodd" /></svg>
                </a>
                {% else %}
                <div class="text-slate-300 dark:text-slate-600 border-slate-200 dark:border-slate-700 px-1.5 py-1 mr-0.5 border rounded-md inline-flex items-center justify-center" title="Last page">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M12.78 7.595a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06l2.72-2.72-2.72-2.72a.75.75 0 0 1 1.06-1.06l3.25 3.25Zm-8.25-3.25 3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06l2.72-2.72-2.72-2.72a.75.75 0 0 1 1.06-1.06Z" clip-rule="evenodd" /></svg>
                </div>
                {% endif %}
            </div>
        </div>

<table class="w-full">
<thead>
    <tr class="bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-700">
    <td class="px-3 py-2 align-top text-xs font-semibold text-slate-500 dark:text-slate-400">#</td>
    <td class="px-3 py-2 align-top text-xs font-semibold text-slate-500 dark:text-slate-400">ID</td>
    <td class="px-3 py-2 align-top text-xs font-semibold text-slate-500 dark:text-slate-400">{% translate "Timestamp" %}</td>
    <td class="px-3 py-2 w-full align-top text-xs font-semibold text-slate-500 dark:text-slate-400">{% translate "Title" %}</td>
    <td class="px-3 py-2 align-top text-xs font-semibold text-slate-500 dark:text-slate-400">{% translate "Release" %}</td>
    <td class="px-3 py-2 align-top text-xs font-semibold text-slate-500 dark:text-slate-400">{% translate "Environment" %}</td>
    </tr>
</thead>
<tbody>

{% for event in page_obj %}
    <tr class="border-b border-slate-100 dark:border-slate-700/50 hover:bg-slate-50 dark:hover:bg-slate-800/50 last:border-b-0">
        <td class="px-3 py-2.5 text-sm text-slate-500 dark:text-slate-300 align-top">
            <a href="{{ script_prefix }}/issues/issue/{{ issue.id }}/event/{{ event.id }}/{% current_qs %}">{{ event.digest_order }}</a>
        </td>
        <td class="px-3 py-2.5 text-sm text-slate-400 dark:text-slate-500 align-top">
            <a href="{{ script_prefix }}/issues/issue/{{ issue.id }}/event/{{ event.id }}/{% current_qs %}">{{ event.id|truncatechars:9 }}</a>
        </td>
        <td class="px-3 py-2.5 text-sm font-mono whitespace-nowrap align-top">
            {{ event.timestamp|date:"j M G:i:s" }}.<span class="text-xs">{{ event.timestamp|date:"u"|slice:":3" }}</span>
        </td>
        <td class="w-full px-3 py-2.5 text-sm font-mono align-top">
            {{ event.title }}
        </td>
        <td class="px-3 py-2.5 text-sm font-mono align-top">
            <span {% if event.release|issha %}class="font-mono"{% endif %}>{{ event.release|shortsha }}</span>
        </td>
        <td class="px-3 py-2.5 text-sm font-mono align-top">
            {{ event.environment|truncatechars:30 }}
        </td>
    </tr>
{% empty %}
    <tr>
        <td colspan="6" class="px-3 py-8 text-center text-sm text-slate-400 dark:text-slate-500 italic">
            {% translate "No events found" %}{% if q %} {% translate "for" %} "{{ q }}"{% endif %}.
        </td>
    </tr>
{% endfor %}
</tbody>
</table>

    </div>
{% endblock %}
